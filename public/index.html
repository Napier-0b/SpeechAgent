<!DOCTYPE html>
<html lang="jp">
<head>
    <meta charset="UTF-8">
    <title>Web Speech API</title>
	<script>
 
	// 利用するWebAPIをインスタンス化する
	// chromeではベンダープレフィックスが必要です。また、Firefoxではブラウザの設定を変更する必要があります
	window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
	const recognition = new SpeechRecognition();
	const synthesis = new SpeechSynthesisUtterance();
 
 
	// 聞き取ったテキストを格納するグローバル変数を定義する
	const defaultInputText = '';
	let inputText= defaultInputText;
 
 
	// 入力をもとに読み上げるテキストを生成する関数を定義する（オウム返しなので、ほとんどの場合でinputをそのままreturnします。）
	const makeResponse = (input) => {
		if (input.includes('ありがとう')) {
			return 'どういたしまして';
		} else {
			return input;
		}
	};
 
 
	// 各種イベントを登録する
 
	// 聞き取りを開始したときのイベント（挙動を把握しやすくするためにconsoleへの出力を定義）
	recognition.addEventListener('start', () => {
		console.info('recognition start');
	});
 
	// 読み上げを開始したときのイベント（挙動を把握しやすくするためにconsoleへの出力を定義）
	synthesis.addEventListener('start', () => {
		console.info('synthesis start');
	});
 
	// 聞き取り中に、マイクからの入力があったときのイベント
	recognition.addEventListener('result', e => {
		console.info(`recognition result : ${e.results[0][0].transcript}`);
 
		// 入力結果をテキストで取得できるので、それをグローバル変数に格納し、聞き取りを終了する
		inputText = e.results[0][0].transcript;
		recognition.stop();
	});
 
	// 聞き取りを終了したときのイベント
	recognition.addEventListener('end', () => {
		console.info(`recognition end. input text = ${inputText}`);
 
		// 入力結果が初期状態の場合は聞き取りが自動終了したと判断し、聞き取りを再開する
		if (inputText === defaultInputText) {
			recognition.start();
		}
		// 入力結果に値があればそれを読み上げ、入力結果を初期化する
		else {
			synthesis.text = makeResponse(inputText);
			document.querySelector('#area1').textContent = inputText;
			inputText= defaultInputText;
			speechSynthesis.speak(synthesis);
		}
	});
 
	// 読み上げを終了したときのイベントを登録する
	synthesis.addEventListener('end', () => {
		console.info(`synthesis end`);
 
		// 聞き取りを再開する
		recognition.start();
	});
 
	// 聞き取りを開始する
	recognition.start();
 
</script>
</head>
<body>
マイクに話した内容を認識し、発話が終了すると読み上げます。
<div id="area1"></div>
</body>
</html>